{% extends "base.html" %}

{% block title %}Call: {{ call.subject }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ call.subject }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'activities:call-update' call.pk %}" class="btn btn-sm btn-primary me-2">Edit</a>
        <a href="{% url 'activities:call-delete' call.pk %}" class="btn btn-sm btn-danger">Delete</a>
        <a href="{% url 'activities:call-list' %}" class="btn btn-sm btn-outline-secondary ms-2">Back to List</a>
    </div>
</div>

<h4>Details</h4>
<dl class="row">
    <dt class="col-sm-3">Subject</dt><dd class="col-sm-9">{{ call.subject }}</dd>
    <dt class="col-sm-3">Call Time</dt><dd class="col-sm-9">{{ call.call_time|date:"Y-m-d H:i"|default:"--" }}</dd>
    <dt class="col-sm-3">Direction</dt><dd class="col-sm-9">{{ call.get_direction_display }}</dd>
    <dt class="col-sm-3">Status</dt><dd class="col-sm-9">{{ call.get_status_display }}</dd>
    <dt class="col-sm-3">Duration</dt><dd class="col-sm-9">{{ call.duration_minutes|default:"--" }} minutes</dd>
    <dt class="col-sm-3">Related To</dt>
    <dd class="col-sm-9">
        {% if call.related_to_account %}<div><a href="{% url 'crm_entities:account-detail' call.related_to_account.pk %}">Account: {{ call.related_to_account.name }}</a></div>{% endif %}
        {% if call.related_to_contact %}<div><a href="{% url 'crm_entities:contact-detail' call.related_to_contact.pk %}">Contact: {{ call.related_to_contact.full_name }}</a></div>{% endif %}
        {% if call.related_to_lead %}<div><a href="{% url 'crm_entities:lead-detail' call.related_to_lead.pk %}">Lead: {{ call.related_to_lead.full_name }}</a></div>{% endif %}
        {% if call.related_to_deal %}<div><a href="{% url 'sales_pipeline:deal-detail' call.related_to_deal.pk %}">Deal: {{ call.related_to_deal }}</a></div>{% endif %}
         {% if not call.related_to_account and not call.related_to_contact and not call.related_to_lead and not call.related_to_deal %}--{% endif %}
    </dd>
    <dt class="col-sm-3">Assigned To</dt>
    <dd class="col-sm-9">
        {% if call.assigned_to %}
            {{ call.assigned_to.get_full_name|default:call.assigned_to.username }}
        {% else %}
            --
        {% endif %}
    </dd>
    <dt class="col-sm-3">Created By</dt>
     <dd class="col-sm-9">
         {% if call.created_by %}
             {{ call.created_by.get_full_name|default:call.created_by.username }}
         {% else %}
             System/Unknown
         {% endif %}
          on {{ call.created_at|date:"Y-m-d H:i"|default:"N/A" }}
     </dd>
    <dt class="col-sm-3">Last Updated</dt><dd class="col-sm-9">{{ call.updated_at|date:"Y-m-d H:i" }}</dd>
</dl>

<h4>Notes</h4>
<div class="card">
    <div class="card-body bg-light">
      {{ call.notes|linebreaksbr|default:"No notes added." }}
    </div>
</div>
<hr>

{% endblock %}